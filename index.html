<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBpfr0ZTuVGPOa72tEi1ui3_vqhA63-jGg",
    authDomain: "breadboard-297d4.firebaseapp.com",
    databaseURL: "https://breadboard-297d4-default-rtdb.firebaseio.com",
    projectId: "breadboard-297d4",
    storageBucket: "breadboard-297d4.firebasestorage.app",
    messagingSenderId: "136042113028",
    appId: "1:136042113028:web:43272123e5aebbf7f56d51"
  };

  firebase.initializeApp(firebaseConfig);

  const loginForm = document.getElementById("loginForm");
  const dashboard = document.getElementById("dashboard");
  const loginBtn = document.getElementById("loginBtn");

  loginBtn.addEventListener("click", () => {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!email || !password) {
      alert("Please enter email and password.");
      return;
    }

    firebase.auth()
      .signInWithEmailAndPassword(email, password)
      .catch(err => {
        console.error(err);
        alert("Login failed");
      });
  });

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      loginForm.style.display = "none";
      dashboard.style.display = "block";
      startRelayControl();
    } else {
      dashboard.style.display = "none";
      loginForm.style.display = "block";
    }
  });

  function startRelayControl() {
    const db = firebase.database();
    const relays = [1, 2, 3, 4];

    relays.forEach(i => {
      const status = document.getElementById("status" + i);
      const btn = document.getElementById("btn" + i);
      const ref = db.ref("relay" + i);

      ref.on("value", snap => {
        const state = snap.val();
        status.innerText = state ? "ON" : "OFF";
        btn.style.backgroundColor = state ? "green" : "blue";
      });

      btn.onclick = () => {
        ref.get().then(snap => ref.set(!snap.val()));
      };
    });

    document.getElementById("allOffBtn").onclick = () => {
      relays.forEach(i => db.ref("relay" + i).set(false));
    };
  }

  document.getElementById("logoutBtn").onclick = () => {
    firebase.auth().signOut();
  };
</script>
